<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üîç Real-Time AI Intrusion Detection</title>
    <style>
        body {
            background-color: #0b0b0b;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        h1 {
            color: #00ff80;
            margin-top: 20px;
        }
        .controls {
            margin-top: 15px;
        }
        button {
            background-color: #00bfa6;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 6px;
            margin: 5px;
            cursor: pointer;
            color: white;
            font-weight: bold;
        }
        button:hover {
            background-color: #009e8f;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin-top: 30px;
        }
        .camera {
            border: 3px solid #00ff80;
            border-radius: 12px;
            overflow: hidden;
        }
        .camera img {
            width: 480px;
            height: 360px;
        }
        .logs {
            background: #121212;
            padding: 20px;
            width: 420px;
            height: 400px;
            border-radius: 10px;
            overflow-y: auto;
            border: 2px solid #333;
            text-align: left;
        }
        .log-entry {
            margin: 5px 0;
            padding: 6px;
            border-bottom: 1px solid #222;
        }
        .normal { color: #00ff80; }
        .intrusion { color: #ff4d4d; font-weight: bold; }
        .alert-border {
            animation: flash 1s infinite alternate;
        }
        @keyframes flash {
            from { border-color: #00ff80; }
            to { border-color: #ff0000; }
        }
    </style>
</head>
<body>

    <h1>üîç Real-Time AI Intrusion Detection</h1>

    <div class="controls">
        <button onclick="startCamera()">‚ñ∂Ô∏è Start Camera Detection</button>
        <button onclick="stopCamera()">‚èπÔ∏è Stop Camera Detection</button>
    </div>

    <div class="container">
        <div class="camera" id="camera-frame">
            <img id="videoFeed" src="{{ url_for('video_feed') }}" alt="Live Camera">
        </div>

        <div class="logs" id="live-logs">
            <h2>üìú Live Logs</h2>
            {% for log in logs %}
                <div class="log-entry {% if 'Normal' in log.activity %}normal{% else %}intrusion{% endif %}">
                    [{{ log.timestamp }}] <b>{{ log.device }}</b> ‚Üí {{ log.activity }}
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Alert Sound -->
    <audio id="alertSound" src="{{ url_for('static', filename='alert.mp3') }}"></audio>

    <script>
        let cameraRunning = true;

        async function fetchLogs() {
            if (!cameraRunning) return;
            try {
                const response = await fetch('/get_logs');
                const data = await response.json();
                const logContainer = document.getElementById('live-logs');
                const cameraFrame = document.getElementById('camera-frame');
                const alertSound = document.getElementById('alertSound');
                
                logContainer.innerHTML = '<h2>üìú Live Logs</h2>';

                let intrusionDetected = false;

                data.forEach(log => {
                    const div = document.createElement('div');
                    div.classList.add('log-entry');
                    if (log.activity.includes('Normal')) {
                        div.classList.add('normal');
                    } else {
                        div.classList.add('intrusion');
                        intrusionDetected = true;
                    }
                    div.innerHTML = `[${log.timestamp}] <b>${log.device}</b> ‚Üí ${log.activity}`;
                    logContainer.appendChild(div);
                });

                if (intrusionDetected) {
                    cameraFrame.classList.add('alert-border');
                    alertSound.play();
                } else {
                    cameraFrame.classList.remove('alert-border');
                }

            } catch (err) {
                console.error('Error fetching logs:', err);
            }
        }

        function startCamera() {
            document.getElementById('videoFeed').src = "{{ url_for('video_feed') }}";
            cameraRunning = true;
        }

        function stopCamera() {
            document.getElementById('videoFeed').src = "";
            cameraRunning = false;
        }

        // Auto-refresh logs every 3 seconds
        setInterval(fetchLogs, 3000);
    </script>

</body>
</html>
